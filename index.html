<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>XQ LIFF</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    :root {
      --red: #d32f2f;
      --black: #111;
      --bg: #fafafa;
      --card: #ffffff;
      --border: #e5e7eb;
    }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", sans-serif; background: var(--bg); color:#111; }
    .wrap { max-width: 480px; margin: 0 auto; padding: 12px 12px 28px; }
    .topbar { display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .title { font-size:18px; font-weight:700; }
    .ghost { background:transparent; border:1px solid var(--border); padding:8px 10px; border-radius:10px; font-size:14px; }
    .ghost:active { opacity:.7; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:14px; padding:12px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
    .grid { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-top:10px; }
    .cell { padding:18px 8px; border:1px dashed var(--border); border-radius:12px; text-align:center; font-size:20px; min-height:56px; user-select:none; background:#fff; }
    .hint { font-size:12px; color:#666; text-align:center; margin-top:6px; }
    .poslabel { font-size:12px; color:#999; display:block; margin-top:4px; }
    .red { color: var(--red) !important; }
    .black { color: var(--black) !important; }

    .controls { display:flex; gap:10px; justify-content:center; margin:12px 0 8px; }
    .btn { border:0; border-radius:12px; padding:12px 16px; font-size:16px; }
    .btn-primary { background:#111; color:#fff; }
    .btn-secondary { background:#f3f4f6; color:#111; border:1px solid var(--border); }

    .pieces { margin-top:10px; }
    .row { display:grid; grid-template-columns: repeat(7, 1fr); gap:8px; }
    .piece-btn { border:1px solid var(--border); background:#fff; border-radius:12px; padding:12px 0; font-size:18px; text-align:center; }
    .piece-btn:active { transform: scale(.98); }
    .footer-pad { height: 8px; }

    .status { margin: 8px 0 0; font-size:12px; color:#666; text-align:center; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="title">è±¡æ£‹åœå¦ - Anan Universe Station</div>
      <button class="ghost" id="reloadBtn">Reload</button>
    </div>

    <div id="status" class="status">åˆå§‹åŒ–ä¸­â€¦</div>

    <div class="card">
      <!-- ä¹å®®æ ¼ï¼ˆä¸Šï¼š4 / ä¸­ï¼š2 1 3 / ä¸‹ï¼š5ï¼‰ -->
      <div class="grid" aria-label="è±¡æ£‹åœå¦-å–®æ›">
        <div></div>
        <div class="cell" id="pos4"><span>4</span><span class="poslabel">â†‘</span></div>
        <div></div>

        <div class="cell" id="pos2"><span>2</span><span class="poslabel">â†</span></div>
        <div class="cell" id="pos1"><span>1</span><span class="poslabel">ä¸­å¿ƒ</span></div>
        <div class="cell" id="pos3"><span>3</span><span class="poslabel">â†’</span></div>

        <div></div>
        <div class="cell" id="pos5"><span>5</span><span class="poslabel">â†“</span></div>
        <div></div>
      </div>

      <div class="controls">
        <button class="btn btn-primary" id="sendBtn">é€å‡º</button>
        <button class="btn btn-secondary" id="clearBtn">æ¸…é™¤</button>
      </div>

      <div class="hint">è‡ªä¸‹æ–¹é¸æ“‡æ£‹å­ï¼Œç³»çµ±æœƒä¾åºæ”¾å…¥ï¼š1 â†’ 2 â†’ 3 â†’ 4 â†’ 5</div>
    </div>

    <!-- æ£‹å­é¸æ“‡ï¼ˆå…©æ’ï¼Œé»‘åœ¨ä¸Šã€ç´…åœ¨ä¸‹ï¼‰ -->
    <div class="pieces">
      <div class="row" style="margin-bottom:8px">
        <!-- é»‘åœ‹ï¼šå°‡ å£« è±¡ è»Š é¦¬ åŒ… å’ -->
        <button class="piece-btn black" data-piece="å°‡">å°‡</button>
        <button class="piece-btn black" data-piece="å£«">å£«</button>
        <button class="piece-btn black" data-piece="è±¡">è±¡</button>
        <button class="piece-btn black" data-piece="è»Š">è»Š</button>
        <button class="piece-btn black" data-piece="é¦¬">é¦¬</button>
        <button class="piece-btn black" data-piece="åŒ…">åŒ…</button>
        <button class="piece-btn black" data-piece="å’">å’</button>
      </div>
      <div class="row">
        <!-- ç´…åœ‹ï¼šå¸¥ ä»• ç›¸ ä¿¥ å‚Œ ç‚® å…µ -->
        <button class="piece-btn red" data-piece="å¸¥">å¸¥</button>
        <button class="piece-btn red" data-piece="ä»•">ä»•</button>
        <button class="piece-btn red" data-piece="ç›¸">ç›¸</button>
        <button class="piece-btn red" data-piece="ä¿¥">ä¿¥</button>
        <button class="piece-btn red" data-piece="å‚Œ">å‚Œ</button>
        <button class="piece-btn red" data-piece="ç‚®">ç‚®</button>
        <button class="piece-btn red" data-piece="å…µ">å…µ</button>
      </div>
      <div class="footer-pad"></div>
    </div>
  </div>

  <script>
    // â˜… æ›¿æ›ç‚ºä½ çš„ LIFF IDï¼ˆå®Œæ•´å­—ä¸²ï¼Œå¯å«é€£å­—è™Ÿå¾Œç¶´ï¼‰
    const LIFF_ID = "2007906926-NZW6EQ7P";

    // å‹¾å­
    const $ = (id) => document.getElementById(id);
    const posEls = { 1: $("pos1"), 2: $("pos2"), 3: $("pos3"), 4: $("pos4"), 5: $("pos5") };
    const statusEl = $("status");

    // ç‹€æ…‹ï¼š1..5 ä½ç½®çš„æ£‹å­ï¼›å€¼ç‚º { type, color } æˆ– null
    const picks = { 1:null, 2:null, 3:null, 4:null, 5:null };

    const RED_SET   = new Set(["å¸¥","ä»•","ç›¸","ä¿¥","å‚Œ","ç‚®","å…µ"]);
    const BLACK_SET = new Set(["å°‡","å£«","è±¡","è»Š","é¦¬","åŒ…","å’"]);

    function pieceColorOf(type) {
      if (RED_SET.has(type)) return "red";
      if (BLACK_SET.has(type)) return "black";
      return null;
    }

    function firstEmptyPos() {
      for (let i=1;i<=5;i++) if (!picks[i]) return i;
      return null;
    }

    function render() {
      for (let i=1;i<=5;i++) {
        const el = posEls[i];
        el.classList.remove("red","black");
        if (picks[i]) {
          el.innerHTML = `<span>${picks[i].type}</span><span class="poslabel">${i}</span>`;
          el.classList.add(picks[i].color === "red" ? "red" : "black");
        } else {
          const dir = i===1?"ä¸­å¿ƒ": i===2?"â†": i===3?"â†’": i===4?"â†‘":"â†“";
          el.innerHTML = `<span>ä½ç½®${i}</span><span class="poslabel">${dir}</span>`;
        }
      }
    }

    function addPiece(type) {
      const color = pieceColorOf(type);
      if (!color) return;
      const pos = firstEmptyPos();
      if (!pos) {
        alert("å·²æ”¾æ»¿ 5 æ ¼ï¼›è‹¥è¦é‡æ–°é¸ï¼Œè«‹æŒ‰ã€Œæ¸…é™¤ã€ã€‚");
        return;
      }
      picks[pos] = { type, color };
      render();
    }

    function clearAll() {
      for (let i=1;i<=5;i++) picks[i] = null;
      render();
    }

    function hardReload() {
      // åŠ æ™‚é–“æˆ³é¿å… WebView å¿«å–
      const base = location.origin + location.pathname;
      location.replace(base + "?t=" + Date.now());
    }

    async function sendResult() {
      const filled = [1,2,3,4,5].map(i => picks[i]?.type || "æœªé¸");
      const text = `æœ¬å±€ï¼š${filled.join(" ")}`;
      try {
        if (liff?.isInClient?.()) {
          await liff.sendMessages([{ type:"text", text }]);
          alert("å·²é€å‡ºï¼Œè¿”å›èŠå¤©å®¤"); liff.closeWindow();
        } else {
          alert(text);
        }
      } catch (e) {
        alert("sendMessages å¤±æ•—ï¼š" + (e?.message||e));
      }
    }

    // ç¶å®š UI
    $("reloadBtn").addEventListener("click", hardReload);
    $("clearBtn").addEventListener("click", clearAll);
    $("sendBtn").addEventListener("click", sendResult);

    document.querySelectorAll(".piece-btn").forEach(btn => {
      btn.addEventListener("click", () => addPiece(btn.dataset.piece));
    });

    // åˆå§‹åŒ– LIFF
    (async () => {
      try {
        statusEl.textContent = "åˆå§‹åŒ– LIFFâ€¦";
        await liff.init({ liffId: LIFF_ID, withLoginOnExternalBrowser: true });
        if (!liff.isLoggedIn()) { statusEl.textContent = "æœªç™»å…¥ â†’ å°å‘ç™»å…¥"; return liff.login(); }
        const profile = await liff.getProfile();
        statusEl.textContent = `Hello, ${profile.displayName} ğŸ‘‹`;
      } catch (err) {
        console.error(err);
        statusEl.textContent = `LIFF åˆå§‹åŒ–å¤±æ•—ï¼š${err?.message || "unknown"}`;
      }
    })();

    // åˆå§‹æ¸²æŸ“
    render();
  </script>
</body>
</html>
